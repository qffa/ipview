{% extends "admin/admin_base.html" %}
{% from "macros.html" import render_modal_form %}


{% block title %}IPView | Site{% endblock %}
{% block site %} class="active"{% endblock %}


{% block modal %}
    <div class="modal fade" id="add-site-modal" tabindex="-1" role="dialg"></div>
    <div class="modal fade" id="edit-site-modal" tabindex="-1" role="dialg"></div>
{% endblock %}


{% block content %}
    <h1 class="page-header">Site</h1>
    <div class="command-btn">
        <button type="button" class="btn btn-default" onclick="addSite()">Add Site</a>
        <button type="button" class="btn btn-default" data-toggle="modal" data-target="#loading-effect">Loading</a>
    </div>
	<table class="table table-hover text-nowrap table-condensed">
		<thead>
			<tr>
				<th>Site Name</th>
				<th>Description</th>
				<th>Action</th>
			</tr>
		</thead>
		<tbody>
		{% for site in sites %}
			<tr>
				<td><a href="{{ url_for("admin.site_detail", site_id=site.id) }}">{{ site.name }}</a></td>
				<td>{{ site.description }}</td>
				<td>
                    <div class="dropdown">
                        <p class="action" id="dropdownMenu1" data-toggle="dropdown"><span class="caret"></span></p>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                            <li><a onclick="editSite({{ site.id }})", href="#">edit</a></li>
                            <li><a href="{{ url_for("admin.delete_site", site_id=site.id) }}">delete</a></li>
                        </ul>
                    </div>
                </td>
			</tr>
        {% endfor %}
		</tbody>
	</table>
{% endblock %}


{% block script %}
    {{ super() }}
    <script>
            function submitForm(event) {
                event.preventDefault();
                var $form =$(this),
                    url = $form.attr("action"),
                    data = $form.serializeArray();
                var posting = $.post(url, data);
                posting.done(function(resp) {
                    if ($(resp).find("#navbar").length > 0) {
                        window.location.reload();
                    }
                    else {
                        $form.parents(".modal").empty().append(resp);
                    }
                })
            }
        function addSite() {
            $("#add-site-modal").load("/admin/site/add");
            $("#add-site-modal").modal("show");
            $("#add-site-modal").on("submit", "#modal-form", submitForm);
        }

        function editSite(siteID) {
            $("#edit-site-modal").load("/admin/site/"+siteID+"/edit");
            $("#edit-site-modal").modal("show")
            $("#edit-site-modal").on("submit", "#modal-form", submitForm);
        }



    </script>

{% endblock %}
